<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DailyOS - Goals & Personal Growth</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom CSS for a modern, glass-effect dark theme */
        body {
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            border-radius: 12px;
        }

        .dashboard-grid {
            display: grid;
            gap: 1.5rem;
            grid-template-columns: repeat(1, minmax(0, 1fr));
        }

        @media (min-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        .card-hover:hover {
            transform: translateY(-5px);
            transition: transform 0.3s ease-in-out;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid transparent;
            transition: all 0.2s ease-in-out;
        }

        .form-control:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.5);
        }

        .goal-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
        }

        .goal-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .progress-bar-container {
            height: 8px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 9999px;
            overflow: hidden;
            width: 100%;
        }

        .progress-bar-fill {
            height: 100%;
            transition: width 0.5s ease-in-out;
        }
        
        .modal {
            display: none;
            animation: fadeIn 0.3s ease-out forwards;
        }
        
        .modal-content {
            animation: fadeInScale 0.3s ease-in-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
        }

        .btn-primary {
            background-color: #6366f1;
            color: white;
        }

        .btn-primary:hover {
            background-color: #4f46e5;
        }
        
        .btn-danger {
            background-color: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

    </style>
</head>
<body class="bg-gray-900 text-white">

    <div id="goals" class="page-section p-4 sm:p-6 lg:p-8">
        <div class="glass-effect p-4 sm:p-6 mb-6">
            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <h2 class="text-xl sm:text-2xl font-bold text-white">Goals & Personal Growth</h2>
                <div class="flex items-center gap-2">
                    <button id="addGoalBtn" class="btn btn-primary flex items-center space-x-2">
                        <i class="fas fa-plus"></i>
                        <span>Add Goal</span>
                    </button>
                </div>
            </div>
            <p class="text-gray-300 mt-2">Set, track, and crush your personal and academic goals.</p>
        </div>

        <div class="dashboard-grid mb-6">
            <div class="glass-effect p-4 sm:p-6 card-hover">
                <h3 class="text-lg font-semibold text-white mb-2">Daily Score</h3>
                <div class="flex items-center justify-between">
                    <p id="productivity-score" class="text-4xl font-extrabold text-green-400">85%</p>
                    <div class="relative w-24 h-24">
                        <canvas id="productivityDonut"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <i class="fas fa-trophy text-yellow-400 text-3xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass-effect p-4 sm:p-6 card-hover">
                <h3 class="text-lg font-semibold text-white mb-2">Current Streak</h3>
                <div class="flex items-center space-x-4">
                    <i class="fas fa-fire text-red-500 text-4xl"></i>
                    <div>
                        <p id="goal-streak" class="text-4xl font-extrabold text-white">7</p>
                        <p class="text-gray-400 text-sm">consecutive days</p>
                    </div>
                </div>
                <p id="motivational-quote" class="text-gray-300 text-sm mt-4 italic">"The secret of getting ahead is getting started."</p>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
            <div class="glass-effect p-4 sm:p-6 card-hover">
                <h3 class="text-lg font-semibold text-white mb-4">Goal Completion Rate</h3>
                <div class="h-64">
                    <canvas id="goalCompletionChart"></canvas>
                </div>
            </div>
            <div class="glass-effect p-4 sm:p-6 card-hover">
                <h3 class="text-lg font-semibold text-white mb-4">Goals by Category</h3>
                <div class="h-64">
                    <canvas id="goalCategoryChart"></canvas>
                </div>
            </div>
        </div>

        <div class="glass-effect p-4 sm:p-6 mb-6">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
                <h3 class="text-lg font-semibold text-white">Your Goals</h3>
                <div class="flex items-center gap-2 w-full sm:w-auto">
                    <select id="goal-filter-category" class="form-control flex-1">
                        <option value="all">All Categories</option>
                        <option value="study">Study</option>
                        <option value="finance">Finance</option>
                        <option value="health">Health</option>
                        <option value="personal">Personal</option>
                    </select>
                    <select id="goal-filter-priority" class="form-control flex-1">
                        <option value="all">All Priorities</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
            </div>
            <div id="goals-list" class="space-y-4">
                <div id="no-goals-message" class="text-center text-gray-500 py-8" style="display: none;">
                    <i class="fas fa-star text-4xl mb-4"></i>
                    <p>No goals added yet. Start by setting your first goal!</p>
                </div>
            </div>
        </div>
    </div>

    <div id="goalModal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="modal-content glass-effect p-6 rounded-xl w-full max-w-md">
            <div class="flex justify-between items-center mb-6">
                <h2 id="modal-title" class="text-2xl font-bold text-white">Add New Goal</h2>
                <button id="closeGoalModal" class="text-gray-400 hover:text-white text-xl">&times;</button>
            </div>
            
            <form id="goalForm" class="space-y-4">
                <div>
                    <label class="block text-white mb-2">Goal Title</label>
                    <input type="text" id="goalTitle" class="form-control" placeholder="e.g., Learn Python Basics" required>
                </div>
                
                <div>
                    <label class="block text-white mb-2">Category</label>
                    <select id="goalCategory" class="form-control">
                        <option value="study">Study</option>
                        <option value="finance">Finance</option>
                        <option value="health">Health</option>
                        <option value="personal">Personal</option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-white mb-2">Priority</label>
                    <select id="goalPriority" class="form-control">
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>

                <div>
                    <label class="block text-white mb-2">Target Date</label>
                    <input type="date" id="goalTargetDate" class="form-control" required>
                </div>

                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="goalCompleted" class="form-checkbox h-5 w-5 text-purple-600 rounded">
                    <label for="goalCompleted" class="text-gray-300">Mark as Completed</label>
                </div>

                <input type="hidden" id="goalId">

                <div class="flex space-x-4">
                    <button type="submit" id="saveGoalBtn" class="flex-1 btn btn-primary">Save Goal</button>
                    <button type="button" id="deleteGoalBtn" class="flex-1 btn btn-danger hidden">Delete Goal</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Mock data storage, in a real app this would be an API call
        const GoalsData = {
            goals: JSON.parse(localStorage.getItem('dailyOS_goals')) || [],
            getGoals: function() {
                return this.goals;
            },
            saveGoals: function() {
                localStorage.setItem('dailyOS_goals', JSON.stringify(this.goals));
            },
            addGoal: function(goal) {
                goal.id = Date.now();
                goal.progress = 0;
                this.goals.push(goal);
                this.saveGoals();
            },
            updateGoal: function(updatedGoal) {
                const index = this.goals.findIndex(g => g.id == updatedGoal.id);
                if (index !== -1) {
                    this.goals[index] = updatedGoal;
                    this.saveGoals();
                }
            },
            deleteGoal: function(goalId) {
                this.goals = this.goals.filter(g => g.id != goalId);
                this.saveGoals();
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            const addGoalBtn = document.getElementById('addGoalBtn');
            const goalModal = document.getElementById('goalModal');
            const closeGoalModalBtn = document.getElementById('closeGoalModal');
            const goalForm = document.getElementById('goalForm');
            const goalsList = document.getElementById('goals-list');
            const noGoalsMessage = document.getElementById('no-goals-message');
            const goalFilterCategory = document.getElementById('goal-filter-category');
            const goalFilterPriority = document.getElementById('goal-filter-priority');
            const modalTitle = document.getElementById('modal-title');
            const saveGoalBtn = document.getElementById('saveGoalBtn');
            const deleteGoalBtn = document.getElementById('deleteGoalBtn');
            const productivityScoreEl = document.getElementById('productivity-score');
            const goalStreakEl = document.getElementById('goal-streak');
            const motivationalQuoteEl = document.getElementById('motivational-quote');

            let goalCompletionChart;
            let goalCategoryChart;
            let productivityDonut;

            addGoalBtn.addEventListener('click', () => openGoalModal());
            closeGoalModalBtn.addEventListener('click', () => closeGoalModal());
            goalForm.addEventListener('submit', handleGoalSubmit);
            goalFilterCategory.addEventListener('change', renderGoals);
            goalFilterPriority.addEventListener('change', renderGoals);
            
            renderGoals();
            initCharts();
            updateGamificationStats();

            function openGoalModal(goal = null) {
                goalForm.reset();
                document.getElementById('goalId').value = '';
                deleteGoalBtn.classList.add('hidden');
                document.getElementById('goalCompleted').checked = false;

                if (goal) {
                    modalTitle.textContent = 'Edit Goal';
                    document.getElementById('goalId').value = goal.id;
                    document.getElementById('goalTitle').value = goal.title;
                    document.getElementById('goalCategory').value = goal.category;
                    document.getElementById('goalPriority').value = goal.priority;
                    document.getElementById('goalTargetDate').value = goal.targetDate;
                    document.getElementById('goalCompleted').checked = goal.completed || false;
                    deleteGoalBtn.classList.remove('hidden');
                    deleteGoalBtn.onclick = (e) => {
                        e.preventDefault();
                        handleDeleteGoal(goal.id);
                    };
                } else {
                    modalTitle.textContent = 'Add New Goal';
                }
                goalModal.classList.remove('hidden');
            }

            function closeGoalModal() {
                goalModal.classList.add('hidden');
                goalForm.reset();
            }

            function handleGoalSubmit(e) {
                e.preventDefault();
                const goalId = document.getElementById('goalId').value;
                const goal = {
                    id: goalId ? parseInt(goalId) : null,
                    title: document.getElementById('goalTitle').value,
                    category: document.getElementById('goalCategory').value,
                    priority: document.getElementById('goalPriority').value,
                    targetDate: document.getElementById('goalTargetDate').value,
                    completed: document.getElementById('goalCompleted').checked,
                    progress: 0
                };

                if (goal.id) {
                    GoalsData.updateGoal(goal);
                    showNotification('Goal updated successfully!', 'success');
                } else {
                    GoalsData.addGoal(goal);
                    showNotification('New goal added!', 'success');
                }
                
                closeGoalModal();
                renderGoals();
                updateCharts();
                updateGamificationStats();
            }
            
            function handleDeleteGoal(goalId) {
                if (confirm('Are you sure you want to delete this goal?')) {
                    GoalsData.deleteGoal(goalId);
                    closeGoalModal();
                    renderGoals();
                    updateCharts();
                    updateGamificationStats();
                    showNotification('Goal deleted!', 'success');
                }
            }

            function renderGoals() {
                const goals = GoalsData.getGoals();
                const filterCategory = goalFilterCategory.value;
                const filterPriority = goalFilterPriority.value;

                const filteredGoals = goals.filter(goal => {
                    const categoryMatch = filterCategory === 'all' || goal.category === filterCategory;
                    const priorityMatch = filterPriority === 'all' || goal.priority === filterPriority;
                    return categoryMatch && priorityMatch;
                }).sort((a, b) => {
                    // Sort by completion status, then by target date, and finally by priority
                    if (a.completed !== b.completed) {
                        return a.completed ? 1 : -1;
                    }
                    const dateA = new Date(a.targetDate);
                    const dateB = new Date(b.targetDate);
                    if (dateA - dateB !== 0) {
                        return dateA - dateB;
                    }
                    const priorityOrder = { 'high': 3, 'medium': 2, 'low': 1 };
                    return priorityOrder[b.priority] - priorityOrder[a.priority];
                });

                goalsList.innerHTML = '';
                if (filteredGoals.length === 0) {
                    noGoalsMessage.style.display = 'block';
                } else {
                    noGoalsMessage.style.display = 'none';
                    filteredGoals.forEach(goal => {
                        const goalItem = createGoalElement(goal);
                        goalsList.appendChild(goalItem);
                    });
                }
            }

            function createGoalElement(goal) {
                const goalEl = document.createElement('div');
                goalEl.className = 'goal-item glass-effect';
                
                const isCompleted = goal.completed;
                const progressBarFillColor = isCompleted ? 'bg-green-500' : 'bg-blue-500';
                const progressPercentage = isCompleted ? 100 : calculateProgress(goal);

                goalEl.innerHTML = `
                    <div class="flex-1 flex flex-col space-y-2">
                        <div class="flex items-center space-x-3">
                            <span class="text-white text-lg font-semibold ${isCompleted ? 'line-through text-gray-400' : ''}">${goal.title}</span>
                            <span class="text-xs px-2 py-1 rounded-full ${getPriorityColor(goal.priority)}">${goal.priority}</span>
                            <span class="text-xs px-2 py-1 rounded-full ${getCategoryColor(goal.category)}">${goal.category}</span>
                        </div>
                        <div class="flex items-center space-x-4">
                            <p class="text-gray-400 text-sm">Due: ${new Date(goal.targetDate).toLocaleDateString()}</p>
                            <p id="time-left-${goal.id}" class="text-sm font-medium"></p>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress-bar-fill ${progressBarFillColor}" style="width: ${progressPercentage}%;"></div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2 ml-4">
                        <button class="edit-btn text-blue-400 hover:text-blue-200">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn text-red-400 hover:text-red-200">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                `;

                goalEl.querySelector('.edit-btn').addEventListener('click', () => openGoalModal(goal));
                goalEl.querySelector('.delete-btn').addEventListener('click', () => handleDeleteGoal(goal.id));
                
                updateTimeLeft(goal.id, goal.targetDate);
                setInterval(() => updateTimeLeft(goal.id, goal.targetDate), 1000 * 60);

                return goalEl;
            }
            
            function getPriorityColor(priority) {
                switch(priority) {
                    case 'high': return 'bg-red-500 text-white';
                    case 'medium': return 'bg-yellow-500 text-black';
                    case 'low': return 'bg-green-500 text-white';
                    default: return 'bg-gray-500 text-white';
                }
            }

            function getCategoryColor(category) {
                switch(category) {
                    case 'study': return 'bg-purple-600 text-white';
                    case 'finance': return 'bg-green-600 text-white';
                    case 'health': return 'bg-blue-600 text-white';
                    case 'personal': return 'bg-gray-600 text-white';
                    default: return 'bg-gray-600 text-white';
                }
            }

            function calculateProgress(goal) {
                const startDate = new Date();
                const targetDate = new Date(goal.targetDate);
                const totalTime = targetDate - startDate;
                const elapsedSinceToday = new Date() - startDate;
                
                if (totalTime <= 0) return 100;

                const progress = Math.min(100, (elapsedSinceToday / totalTime) * 100);
                return Math.max(0, progress);
            }

            function updateTimeLeft(goalId, targetDateStr) {
                const targetDate = new Date(targetDateStr);
                const now = new Date();
                const timeLeft = targetDate - now;
                const timeLeftEl = document.getElementById(`time-left-${goalId}`);

                if (timeLeftEl) {
                    if (timeLeft < 0) {
                        timeLeftEl.textContent = 'Overdue';
                        timeLeftEl.className = 'text-sm text-red-500 font-medium';
                    } else {
                        const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        timeLeftEl.textContent = `${days}d ${hours}h left`;
                        timeLeftEl.className = 'text-sm text-yellow-400 font-medium';
                    }
                }
            }
            
            function initCharts() {
                const goals = GoalsData.getGoals();
                const completedGoalsCount = goals.filter(g => g.completed).length;
                const totalGoals = goals.length;
                const goalCompletionRate = totalGoals > 0 ? (completedGoalsCount / totalGoals * 100).toFixed(0) : 0;
                
                // Goal Completion Chart
                const completionCtx = document.getElementById('goalCompletionChart').getContext('2d');
                if (goalCompletionChart) goalCompletionChart.destroy();
                goalCompletionChart = new Chart(completionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Completed', 'Pending'],
                        datasets: [{
                            data: [completedGoalsCount, totalGoals - completedGoalsCount],
                            backgroundColor: ['#4ade80', '#e5e7eb'],
                            hoverOffset: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: 'white' } },
                            title: {
                                display: true,
                                text: `Overall: ${goalCompletionRate}% Completed`,
                                color: 'white'
                            }
                        }
                    }
                });
                
                // Goals by Category Chart
                const categoryCounts = goals.reduce((acc, goal) => {
                    acc[goal.category] = (acc[goal.category] || 0) + 1;
                    return acc;
                }, {});
                
                const categoryLabels = Object.keys(categoryCounts);
                const categoryData = Object.values(categoryCounts);
                const categoryBgColors = categoryLabels.map(cat => {
                    switch(cat) {
                        case 'study': return '#8b5cf6';
                        case 'finance': return '#10b981';
                        case 'health': return '#3b82f6';
                        case 'personal': return '#6b7280';
                        default: return '#9ca3af';
                    }
                });

                const categoryCtx = document.getElementById('goalCategoryChart').getContext('2d');
                if (goalCategoryChart) goalCategoryChart.destroy();
                goalCategoryChart = new Chart(categoryCtx, {
                    type: 'bar',
                    data: {
                        labels: categoryLabels,
                        datasets: [{
                            label: 'Number of Goals',
                            data: categoryData,
                            backgroundColor: categoryBgColors
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { beginAtZero: true, ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                            x: { ticks: { color: 'white' }, grid: { color: 'rgba(255,255,255,0.1)' } }
                        },
                        plugins: { legend: { labels: { color: 'white' } } }
                    }
                });

                // Productivity Donut Chart
                const score = calculateProductivityScore();
                productivityScoreEl.textContent = `${score}%`;
                const productivityCtx = document.getElementById('productivityDonut').getContext('2d');
                if (productivityDonut) productivityDonut.destroy();
                productivityDonut = new Chart(productivityCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Productivity', ''],
                        datasets: [{
                            data: [score, 100 - score],
                            backgroundColor: ['#34d399', 'rgba(255,255,255,0.1)'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        cutout: '80%',
                        plugins: {
                            legend: { display: false },
                            tooltip: { enabled: false }
                        }
                    }
                });
            }

            function updateGamificationStats() {
                const goals = GoalsData.getGoals();
                const today = new Date().toDateString();
                const yesterday = new Date(new Date().setDate(new Date().getDate() - 1)).toDateString();
                let streak = parseInt(localStorage.getItem('dailyOS_streak')) || 0;
                let lastCompletionDate = localStorage.getItem('dailyOS_last_completion_date');

                // Check for goals completed today
                const completedToday = goals.some(g => g.completed && new Date(g.targetDate).toDateString() === today);

                // Update streak logic
                if (completedToday && lastCompletionDate !== today) {
                    streak++;
                    localStorage.setItem('dailyOS_streak', streak);
                    localStorage.setItem('dailyOS_last_completion_date', today);
                } else if (!completedToday && lastCompletionDate !== yesterday) {
                    // Reset streak if a day is missed
                    streak = 0;
                    localStorage.setItem('dailyOS_streak', streak);
                }

                goalStreakEl.textContent = streak;
                
                // AI-driven insights (simplified logic)
                const missedDeadlines = goals.filter(g => !g.completed && new Date(g.targetDate) < new Date());
                const overspendingGoals = goals.filter(g => g.category === 'finance' && new Date(g.targetDate) < new Date());

                if (overspendingGoals.length > 0) {
                    motivationalQuoteEl.textContent = "Your financial goals are a bit behind. Let's review your spending in the Analytics tab.";
                } else if (missedDeadlines.length > 2) {
                    motivationalQuoteEl.textContent = "A few goals are overdue. Try setting smaller, more manageable milestones to regain momentum!";
                } else if (streak > 3) {
                    motivationalQuoteEl.textContent = "You're building an incredible streak! Keep up the momentum!";
                } else {
                    motivationalQuoteEl.textContent = "Ready to achieve something great today? Add a new goal and get started!";
                }
            }
            
            function calculateProductivityScore() {
                const goals = GoalsData.getGoals();
                if (goals.length === 0) return 0;
                
                const completedCount = goals.filter(g => g.completed).length;
                return Math.floor((completedCount / goals.length) * 100);
            }

            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg text-white ${type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500'}`;
                notification.innerHTML = `<p>${message}</p>`;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 3000);
            }
        });
    </script>
</body>
</html>