<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DailyOS - User Onboarding</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    
    <style>
        :root {
            --primary: #4361ee; --secondary: #3a0ca3; --accent: #7209b7;
            --success: #4cc9f0; --warning: #f72585; --light: #f8f9fa;
            --dark: #212529; --gray: #6c757d; --light-bg: #f0f2f5;
            --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); --transition: all 0.3s ease;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { color: var(--dark); line-height: 1.6; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; position: relative; overflow-x: hidden; }

        /* Video Background */
        .background-video {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1; filter: brightness(0.6) blur(2px);
        }

        .onboarding-container { 
            display: flex; width: 100%; max-width: 1000px; min-height: 600px; background: rgba(255, 255, 255, 0.9);
            border-radius: 20px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(10px); animation: fadeIn 1s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Ensure the parent container is set to relative for positioning */
.welcome-section {
    position: relative; 
    overflow: hidden; 
}

/* Style the video to be a background */
   .welcome-background-video {
       position: absolute;
       top: 0;
       left: 0;
       width: 100%;
       height: 100%;
       object-fit: cover; /* Ensures video covers the entire space without distortion */
       z-index: 1; /* Puts the video behind the content */
       filter: brightness(0.7) grayscale(0.5); /* Adds a filter for better text readability */
       }

/* Ensure the content is above the video */
      .welcome-content {
       position: relative;
       z-index: 2;
         }
        .welcome-section h1 { 
            font-size: 36px; font-weight: 800; margin-bottom: 15px; 
            background: linear-gradient(45deg, #4cc9f0, #f72585); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
        }
        .welcome-section p { font-size: 18px; margin-bottom: 30px; opacity: 0.9; }
        .feature-list { list-style: none; margin-top: 30px; }
        .feature-list li { display: flex; align-items: center; margin-bottom: 15px; font-size: 16px; }
        .feature-list i { background: rgba(255, 255, 255, 0.2); width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; }
        
        .form-section { flex: 1; padding: 40px; display: flex; flex-direction: column; justify-content: center; }
        .form-container { width: 100%; max-width: 400px; margin: 0 auto; }
        .logo { text-align: center; margin-bottom: 30px; }
        .logo h2 { 
            font-size: 28px; font-weight: 800; 
            background: linear-gradient(45deg, var(--primary), var(--secondary)); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
        }
        .logo p { color: var(--gray); margin-top: 5px; }
        .form-toggle { display: flex; margin-bottom: 30px; background: var(--light-bg); border-radius: 10px; padding: 5px; }
        .toggle-btn { flex: 1; padding: 12px; text-align: center; cursor: pointer; border-radius: 8px; font-weight: 600; transition: var(--transition); }
        .toggle-btn.active { background: white; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1); }
        .form { display: none; animation: slideUp 0.5s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .form.active { display: block; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark); }
        
        /* Enhanced input styles */
        .input-with-icon { position: relative; }
        .input-with-icon i { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: var(--gray); }
        .form-control { 
            width: 100%; padding: 15px 15px 15px 45px; border: 2px solid #eaeaea; 
            border-radius: 10px; font-size: 16px; transition: var(--transition); 
            color: #4b4b4b; 
        }
        .form-control::placeholder { color: #a0a0a0; }
        .form-control:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2); }
        
        .password-toggle { position: absolute; right: 15px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--gray); }
        .form-options { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .forgot-password { color: var(--primary); text-decoration: none; font-weight: 600; transition: var(--transition); }
        .forgot-password:hover { color: var(--secondary); }
        
        /* Enhanced button styles */
        .btn { 
            width: 100%; padding: 15px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; 
            cursor: pointer; transition: var(--transition); 
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--secondary); transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2); }
        
        .divider { text-align: center; margin: 25px 0; position: relative; }
        .divider::before { content: ""; position: absolute; left: 0; top: 50%; width: 100%; height: 1px; background: #eaeaea; }
        .divider span { background: white; padding: 0 15px; position: relative; color: var(--gray); }
        
        /* Enhanced social button styles */
        .social-login { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .btn-social { 
            display: flex; align-items: center; justify-content: center; padding: 12px; 
            border: 2px solid #eaeaea; border-radius: 10px; background: white; 
            font-weight: 600; cursor: pointer; transition: var(--transition); 
        }
        .btn-social:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        .btn-social i { margin-right: 8px; font-size: 18px; }
        .btn-google { color: #DB4437; }
        .btn-facebook { color: #4267B2; }
        .btn-github { color: #333; }
        
        .form-footer a { color: var(--primary); text-decoration: none; font-weight: 600; transition: var(--transition); }
        .form-footer a:hover { color: var(--secondary); }
        
        .message-box { 
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; 
            padding: 1rem 1.5rem; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); 
            text-align: center; transition: all 0.3s ease-in-out; opacity: 0; pointer-events: none; 
        }
        .message-box.show { opacity: 1; transform: translate(-50%, 10px); pointer-events: auto; }
        .message-box.success { background-color: #10b981; color: white; }
        .message-box.error { background-color: #ef4444; color: white; }

        .terms-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px); z-index: 1000; display: flex; justify-content: center;
            align-items: center; opacity: 0; pointer-events: none; transition: opacity 0.5s ease;
        }
        .terms-modal.show { opacity: 1; pointer-events: auto; }
        .terms-content {
            background: white; padding: 40px; border-radius: 10px; max-width: 600px;
            animation: slideUp 0.5s ease; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); position: relative;
        }
        .terms-content h2 { font-size: 24px; font-weight: 700; margin-bottom: 20px; color: var(--primary); }
        .terms-text {
            max-height: 300px; overflow-y: auto; border: 1px solid #e0e0e0; padding: 15px;
            border-radius: 8px; margin-bottom: 20px; line-height: 1.5;
        }
        .terms-checkbox-group { display: flex; align-items: center; margin-bottom: 20px; }
        .terms-checkbox-group input { margin-right: 10px; }

        .luxury-footer {
            position: fixed; bottom: 0; left: 0; width: 100%; padding: 20px;
            background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); color: #fff;
            text-align: center; opacity: 0.8; z-index: 500; transition: transform 0.5s ease;
            transform: translateY(100%);
        }
        .luxury-footer.show { transform: translateY(0); }
        .footer-social-links {
            display: flex; justify-content: center; align-items: center; gap: 1.5rem;
            margin-top: 1.5rem;
        }
        .footer-social-links a {
            color: #fff; opacity: 0.8; font-size: 1.5rem; transition: transform 0.3s, opacity 0.3s, color 0.3s;
        }
        .footer-social-links a:hover { opacity: 1; transform: scale(1.1); }
        .footer-social-links a.github:hover { color: #333; }
        .footer-social-links a.website:hover { color: #4361ee; }
        .footer-social-links a.instagram:hover { color: #E1306C; }
        .footer-social-links a.mail:hover { color: #f72585; }
        .logo-img {
            width: 80px; height: 80px; margin-bottom: 20px;
            animation: logo-spin 4s linear infinite; border-radius: 50%;
            object-fit: cover;
        }
        @keyframes logo-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @media (max-width: 768px) {
            body { padding: 10px; }
            .onboarding-container { 
                flex-direction: column; max-width: 100%; min-height: auto; 
            }
            .welcome-section { display: none; }
            .form-section { padding: 20px; }
        }
    </style>
</head>
<body>
    <video class="background-video" autoplay loop muted playsinline>
        <source src="https://videos.pexels.com/video-files/5965421/5965421-hd_1920_1080_25fps.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    <div id="message-box" class="message-box"></div>
    <div class="terms-modal" id="termsModal">
        <div class="terms-content animate__animated animate__zoomIn">
            <h2>Terms and Conditions</h2>
            <div class="terms-text">
                <p>Welcome to DailyOS! By using our platform, you agree to the following terms and conditions. These terms govern your use of DailyOS, including all features and services provided. If you do not agree with these terms, you should not use our service.</p>
                <br>
                <h3>1. Account Registration</h3>
                <p>To access certain features, you must register for an account. You agree to provide accurate, current, and complete information during the registration process and to update such information to keep it accurate, current, and complete. You are responsible for safeguarding your password and for any activities or actions under your account.</p>
                <br>
                <h3>2. User Conduct</h3>
                <p>You agree not to use DailyOS for any unlawful or prohibited purpose. You shall not upload or transmit any content that is harmful, threatening, abusive, harassing, defamatory, obscene, or otherwise objectionable.</p>
                <br>
                <h3>3. Intellectual Property</h3>
                <p>All content on DailyOS, including text, graphics, and software, is the property of DailyOS or its content suppliers and is protected by intellectual property laws. You may not reproduce, distribute, or create derivative works from any content without our express written permission.</p>
                <br>
                <h3>4. Limitation of Liability</h3>
                <p>DailyOS is provided on an "as is" and "as available" basis. We do not warrant that the service will be uninterrupted, error-free, or secure. In no event shall DailyOS be liable for any direct, indirect, incidental, special, or consequential damages arising out of or in connection with your use of the service.</p>
                <br>
                <h3>5. Termination</h3>
                <p>We reserve the right to terminate or suspend your account at our sole discretion, without prior notice or liability, for any reason, including but not limited to a breach of these terms.</p>
            </div>
            <div class="terms-checkbox-group">
                <input type="checkbox" id="acceptTerms">
                <label for="acceptTerms">I accept the Terms and Conditions.</label>
            </div>
            <button class="btn btn-primary" id="acceptTermsBtn" disabled>Continue</button>
        </div>
    </div>
  <div class="welcome-section">
    <video class="welcome-background-video" autoplay loop muted playsinline>
        <source src="Video_Edited_with_Logo.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    
    <div class="welcome-content">
        <h1 class="animate__animated animate__fadeInLeft">Welcome to DailyOS</h1>
        <p class="animate__animated animate__fadeInLeft animate__delay-1s">Take control of your day with our powerful, simple-to-use platform.</p>
        <ul class="feature-list animate__animated animate__fadeInLeft animate__delay-2s">
            <li><i class="fas fa-check"></i> Manage tasks and projects</li>
            <li><i class="fas fa-check"></i> Organize your calendar</li>
            <li><i class="fas fa-check"></i> Sync across all your devices</li>
            <li><i class="fas fa-check"></i> Get personalized productivity insights</li>
        </ul>
    </div>
</div>
        
        <div class="form-section">
            <div class="form-container">
                <div class="logo">
                    <h2>DailyOS</h2>
                    <p>Your personal productivity assistant</p>
                </div>
                
                <div class="form-toggle">
                    <div class="toggle-btn active" id="loginToggle">Login</div>
                    <div class="toggle-btn" id="registerToggle">Register</div>
                </div>
                
                <form id="loginForm" class="form active" onsubmit="handleLoginSubmit(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="loginEmail" class="form-control" placeholder="Enter your email" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" required>
                            <span class="password-toggle" onclick="togglePasswordVisibility('loginPassword')">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                    </div>
                    <div class="form-options">
                        <div></div>
                        <a href="#" class="forgot-password" id="forgot-password-link">Forgot Password?</a>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        Sign In
                    </button>
                </form>

                <form id="registerForm" class="form" onsubmit="handleRegisterSubmit(event)">
                    <div class="form-group">
                        <label for="registerUsername">Username</label>
                        <div class="input-with-icon">
                            <i class="fas fa-user"></i>
                            <input type="text" id="registerUsername" class="form-control" placeholder="Create a username" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="registerEmail">Email</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="registerEmail" class="form-control" placeholder="Enter your email" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">Password</label>
                        <div class="input-with-icon">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="registerPassword" class="form-control" placeholder="Create a password" required>
                            <span class="password-toggle" onclick="togglePasswordVisibility('registerPassword')">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        Create Account
                    </button>
                </form>

                <form id="resetForm" class="form" onsubmit="handleResetSubmit(event)">
                    <p class="mb-4 text-center text-gray-600">Enter your email to receive a reset link.</p>
                    <div class="form-group">
                        <label for="resetEmail">Email</label>
                        <div class="input-with-icon">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="resetEmail" class="form-control" placeholder="Enter your email" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Send Reset Link</button>
                    <div class="form-footer">
                        <p><a href="#" id="back-to-login-link">Back to Login</a></p>
                    </div>
                </form>
                
                <div id="common-form-elements">
                    <div class="divider"><span>Or continue with</span></div>
                    <div class="social-login">
                        <button type="button" class="btn-social btn-google" id="google-login"><i class="fab fa-google"></i> Google</button>
                        <button type="button" class="btn-social btn-facebook" id="facebook-login"><i class="fab fa-facebook-f"></i> Facebook</button>
                        <button type="button" class="btn-social btn-github" id="github-login"><i class="fab fa-github"></i> GitHub</button>
                    </div>
                    <div class="form-footer">
                        <p id="login-footer-text">Don't have an account? <a href="#" id="showRegisterLink">Sign Up</a></p>
                        <p id="register-footer-text" style="display: none;">Already have an account? <a href="#" id="showLoginLink">Sign In</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <footer class="luxury-footer text-center p-4 text-white opacity-80">
        <div class="footer-social-links">
            <a href="https://github.com/hugarabhi" target="_blank" class="github"><i class="fab fa-github"></i></a>
            <a href="https://abhiwebdesign.great-site.net/?i=1" target="_blank" class="website"><i class="fas fa-globe"></i></a>
            <a href="https://instagram.com/_abhi_1435_" target="_blank" class="instagram"><i class="fab fa-instagram"></i></a>
            <a href="mailto:avinashhugar299@example.com" class="mail"><i class="fas fa-envelope"></i></a>
        </div>
        <p class="mt-4 text-sm">&copy; 2024 DailyOS. All rights reserved.</p>
    </footer>

<script type="module">
// --- Firebase SDKs ---
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendPasswordResetEmail, signInWithPopup, GoogleAuthProvider, FacebookAuthProvider, GithubAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

// --- Firebase Configuration ---
const firebaseConfig = {
    apiKey: "AIzaSyCS06RYItsN_lYq0ZI-Yfv2WRzyuac28EY",
    authDomain: "dailyos-f2eb6.firebaseapp.com",
    projectId: "dailyos-f2eb6",
    storageBucket: "dailyos-f2eb6.firebasestorage.app",
    messagingSenderId: "173476838340",
    appId: "1:173476838340:web:a0811c7c42615cf27f4291",
    measurementId: "G-QDM68MDX6S"
};

// --- Initialize Firebase ---
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- DOM Elements ---
const onboardingContainer = document.getElementById('onboardingContainer');
const termsModal = document.getElementById('termsModal');
const acceptTermsCheckbox = document.getElementById('acceptTerms');
const acceptTermsBtn = document.getElementById('acceptTermsBtn');
const messageBox = document.getElementById('message-box');
const loginToggle = document.getElementById('loginToggle');
const registerToggle = document.getElementById('registerToggle');
const loginForm = document.getElementById('loginForm');
const registerForm = document.getElementById('registerForm');
const resetForm = document.getElementById('resetForm');
const showRegisterLink = document.getElementById('showRegisterLink');
const showLoginLink = document.getElementById('showLoginLink');
const forgotPasswordLink = document.getElementById('forgot-password-link');
const backToLoginLink = document.getElementById('back-to-login-link');
const commonFormElements = document.getElementById('common-form-elements');
const loginFooterText = document.getElementById('login-footer-text');
const registerFooterText = document.getElementById('register-footer-text');
const luxuryFooter = document.querySelector('.luxury-footer');

// --- T&C Modal Logic ---
const showTermsModal = () => {
    termsModal.classList.add('show');
};

const hideTermsModal = () => {
    termsModal.classList.remove('show');
    onboardingContainer.style.display = 'flex';
};

acceptTermsCheckbox.addEventListener('change', () => {
    acceptTermsBtn.disabled = !acceptTermsCheckbox.checked;
});

acceptTermsBtn.addEventListener('click', () => {
    if (acceptTermsCheckbox.checked) {
        localStorage.setItem('termsAccepted', 'true');
        hideTermsModal();
    }
});

document.addEventListener('DOMContentLoaded', () => {
    if (localStorage.getItem('termsAccepted') === 'true') {
        onboardingContainer.style.display = 'flex';
    } else {
        showTermsModal();
    }
});

// --- Auth State Observer (Core Logic) ---
onAuthStateChanged(auth, user => {
    if (user) {
        // Redirect to dashboard.html after successful authentication
        window.location.href = 'dashboard.html';
    }
});

// --- UI Helper Functions ---
function showMessage(message, type = 'success', redirect = false) {
    messageBox.textContent = message;
    messageBox.className = `message-box show ${type}`;
    setTimeout(() => {
        messageBox.classList.remove('show');
        if (redirect) {
            window.location.href = 'dashboard.html';
        }
    }, 3000);
}

function showForm(formToShow) {
    [loginForm, registerForm, resetForm].forEach(form => form.classList.remove('active'));
    
    // Hide common elements for the reset form
    if (formToShow === 'reset') {
        commonFormElements.style.display = 'none';
    } else {
        commonFormElements.style.display = 'block';
    }

    if (formToShow === 'login') {
        loginForm.classList.add('active');
        loginToggle.classList.add('active');
        registerToggle.classList.remove('active');
        loginFooterText.style.display = 'block';
        registerFooterText.style.display = 'none';
    } else if (formToShow === 'register') {
        registerForm.classList.add('active');
        registerToggle.classList.add('active');
        loginToggle.classList.remove('active');
        loginFooterText.style.display = 'none';
        registerFooterText.style.display = 'block';
    } else if (formToShow === 'reset') {
        resetForm.classList.add('active');
        loginToggle.classList.remove('active');
        registerToggle.classList.remove('active');
    }
}

function togglePasswordVisibility(id) {
    const input = document.getElementById(id);
    const icon = input.nextElementSibling.querySelector('i');
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
    }
}

// Basic email validation
const isValidEmail = (email) => {
    const re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(String(email).toLowerCase());
}

// --- Firebase Authentication Handlers ---
async function handleLoginSubmit(event) {
    event.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;

    if (!isValidEmail(email)) {
        showMessage('Please enter a valid email address.', 'error');
        return;
    }

    try {
        await signInWithEmailAndPassword(auth, email, password);
        showMessage('Sign in successful! Redirecting...', 'success', true);
    } catch (error) {
        let errorMessage = 'An error occurred during login.';
        switch(error.code) {
            case 'auth/invalid-email':
            case 'auth/user-not-found':
                errorMessage = 'No user found with that email. Please check your email or register.';
                break;
            case 'auth/wrong-password':
                errorMessage = 'Incorrect password. Please try again.';
                break;
            case 'auth/invalid-credential':
                errorMessage = 'Invalid login credentials. Please check your email and password.';
                break;
            default:
                errorMessage = error.message;
        }
        showMessage(errorMessage, 'error');
    }
}

async function handleRegisterSubmit(event) {
    event.preventDefault();
    const username = document.getElementById('registerUsername').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    
    if (!isValidEmail(email)) {
        showMessage('Please enter a valid email address.', 'error');
        return;
    }

    if (password.length < 6) {
        showMessage('Password should be at least 6 characters long.', 'error');
        return;
    }

    try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        // Save the username to Firestore
        await setDoc(doc(db, "users", userCredential.user.uid), {
            username: username,
            email: userCredential.user.email,
            createdAt: new Date()
        });
        showMessage('Account created successfully! Redirecting...', 'success', true);
    } catch (error) {
        let errorMessage = 'An error occurred during registration.';
        switch(error.code) {
            case 'auth/email-already-in-use':
                errorMessage = 'This email is already in use. Try logging in or resetting your password.';
                break;
            case 'auth/weak-password':
                errorMessage = 'The password is too weak. Please choose a stronger one.';
                break;
            default:
                errorMessage = error.message;
        }
        showMessage(errorMessage, 'error');
    }
}

async function handleResetSubmit(event) {
    event.preventDefault();
    const email = document.getElementById('resetEmail').value;

    if (!isValidEmail(email)) {
        showMessage('Please enter a valid email address.', 'error');
        return;
    }

    try {
        await sendPasswordResetEmail(auth, email);
        showMessage('Password reset email sent! Check your inbox.', 'success');
        showForm('login');
    } catch (error) {
        if (error.code === 'auth/user-not-found') {
            showMessage('No account found with that email address.', 'error');
        } else {
            showMessage(error.message, 'error');
        }
    }
}

// --- Event Listeners for UI ---
loginToggle.addEventListener('click', () => showForm('login'));
registerToggle.addEventListener('click', () => showForm('register'));
showRegisterLink.addEventListener('click', e => { e.preventDefault(); showForm('register'); });
showLoginLink.addEventListener('click', e => { e.preventDefault(); showForm('login'); });
forgotPasswordLink.addEventListener('click', e => { e.preventDefault(); showForm('reset'); });
backToLoginLink.addEventListener('click', e => { e.preventDefault(); showForm('login'); });

const handleSocialLogin = (provider) => {
    signInWithPopup(auth, provider)
      .then(() => {
        showMessage('Sign in successful! Redirecting...', 'success', true);
      })
      .catch(error => {
        let errorMessage = 'Social login failed.';
        if (error.code === 'auth/account-exists-with-different-credential') {
            errorMessage = 'An account with this email already exists. Please use the original login method.';
        } else {
            errorMessage = error.message;
        }
        showMessage(errorMessage, 'error');
      });
};

document.getElementById('google-login').addEventListener('click', () => handleSocialLogin(new GoogleAuthProvider()));
document.getElementById('facebook-login').addEventListener('click', () => handleSocialLogin(new FacebookAuthProvider()));
document.getElementById('github-login').addEventListener('click', () => handleSocialLogin(new GithubAuthProvider()));

// --- Footer animation logic ---
let lastScrollY = window.scrollY;

const handleScroll = () => {
    if (window.scrollY > lastScrollY) {
        // Scrolling down
        luxuryFooter.classList.remove('show');
    } else {
        // Scrolling up
        luxuryFooter.classList.add('show');
    }
    lastScrollY = window.scrollY;
};

// Add a slight delay to the scroll listener for better performance
let scrollTimeout;
window.addEventListener('scroll', () => {
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(handleScroll, 50);
});

// Show the footer initially
setTimeout(() => {
    luxuryFooter.classList.add('show');
}, 500);

// Expose functions for onclick handlers
window.togglePasswordVisibility = togglePasswordVisibility;
window.handleLoginSubmit = handleLoginSubmit;
window.handleRegisterSubmit = handleRegisterSubmit;
window.handleResetSubmit = handleResetSubmit;
</script>
</body>
</html>


