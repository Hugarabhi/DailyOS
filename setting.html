<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settings - DailyOS</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --background-dark: #0F172A; /* slate-900 */
            --background-light: #F1F5F9; /* slate-100 */
            --card-dark: #1E293B; /* slate-800 */
            --card-light: #FFFFFF;
            --text-dark-primary: #F1F5F9; /* slate-100 */
            --text-dark-secondary: #94A3B8; /* slate-400 */
            --text-light-primary: #0F172A; /* slate-900 */
            --text-light-secondary: #475569; /* slate-600 */
            --accent: #38BDF8; /* sky-400 */
            --accent-hover: #0EA5E9; /* sky-500 */
            --border-dark: #334155; /* slate-700 */
            --border-light: #CBD5E1; /* slate-300 */
        }

        .dark body {
            background-color: var(--background-dark);
            color: var(--text-dark-primary);
        }

        body {
            background-color: var(--background-light);
            color: var(--text-light-primary);
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Custom scrollbar for a futuristic look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--border-dark);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #475569; /* slate-600 */
        }

        /* Accordion content transition */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0, 1, 0, 1);
        }

        .accordion-content.open {
            max-height: 2000px; /* Adjust as needed */
            transition: max-height 1s ease-in-out;
        }

        /* Custom toggle switch */
        .toggle-checkbox:checked + .toggle-label {
            background-color: var(--accent);
        }
        .toggle-checkbox:checked ~ .dot {
            transform: translateX(1.5rem);
        }
    </style>
</head>

<body class="transition-colors duration-300">

    <div class="flex min-h-screen">
        <!-- Main Content -->
        <main class="w-full p-4 sm:p-6 md:p-8 transition-all duration-300">
            <header class="flex justify-between items-center mb-8">
                <div>
                    <h1 class="text-3xl font-bold">Settings</h1>
                    <p class="text-slate-400 mt-1">Manage your DailyOS experience.</p>
                </div>
                <div class="flex items-center gap-4">
                    <div class="relative hidden sm:block">
                        <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500"></i>
                        <input type="text" id="search-settings" placeholder="Search settings..." class="bg-slate-800 border border-slate-700 rounded-lg pl-10 pr-4 py-2 w-64 focus:outline-none focus:ring-2 focus:ring-sky-500 transition-all">
                    </div>
                    <button class="p-2 rounded-full hover:bg-slate-800 transition-colors" aria-label="Notifications">
                        <i data-lucide="bell" class="w-5 h-5 text-slate-400"></i>
                    </button>
                </div>
            </header>

            <div id="settings-container" class="space-y-6">
                <!-- Settings sections will be injected by JS -->
            </div>
        </main>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden opacity-0 transition-opacity duration-300">
        <div class="bg-slate-800 rounded-xl shadow-2xl p-8 w-full max-w-md border border-slate-700 transform scale-95 transition-transform duration-300">
            <h2 id="modal-title" class="text-2xl font-bold text-slate-100">Are you sure?</h2>
            <p id="modal-description" class="text-slate-400 mt-2 mb-6">This action cannot be undone. Please confirm you want to proceed.</p>
            <div class="flex justify-end gap-4">
                <button id="modal-cancel" class="px-4 py-2 rounded-md bg-slate-600 hover:bg-slate-500 text-white font-semibold transition-colors">Cancel</button>
                <button id="modal-confirm" class="px-4 py-2 rounded-md bg-red-600 hover:bg-red-500 text-white font-semibold transition-colors">Confirm</button>
            </div>
        </div>
    </div>
    
    <!-- Tooltip -->
    <div id="tooltip" class="absolute bg-slate-900 text-white text-sm px-3 py-1.5 rounded-md shadow-lg z-50 opacity-0 transition-opacity pointer-events-none border border-slate-700"></div>

    <!-- Toast Notification -->
    <div id="toast-notification" class="fixed bottom-5 right-5 bg-sky-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-500 z-50">
        <p id="toast-message">Action completed!</p>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- DATA ---
            const settingsConfig = [
                { id: 'profile-personalization', title: 'Profile & Personalization', icon: 'user-cog' },
                { id: 'privacy-security', title: 'Privacy & Security', icon: 'shield-check' },
                { id: 'notifications-alerts', title: 'Notifications & Alerts', icon: 'bell-ring' },
                { id: 'backup-data', title: 'Backup & Data Control', icon: 'cloud-cog' },
                { id: 'help-support', title: 'Help & Support', icon: 'help-circle' }
            ];

            const userProfile = {
                name: 'Avinash Hugar',
                email: 'avinash.hugar@example.com',
                phone: '+919876543210'
            };

            // --- ELEMENT REFERENCES ---
            const settingsContainer = document.getElementById('settings-container');
            const searchInput = document.getElementById('search-settings');
            const confirmationModal = document.getElementById('confirmation-modal');
            const tooltipElement = document.getElementById('tooltip');


            // --- UI RENDERING ---

            function createToggle(id, label, checked = false) {
                return `
                    <label for="${id}" class="flex items-center cursor-pointer">
                        <div class="relative">
                            <input id="${id}" type="checkbox" class="sr-only toggle-checkbox" ${checked ? 'checked' : ''}>
                            <div class="block bg-slate-600 w-14 h-8 rounded-full toggle-label transition-colors"></div>
                            <div class="dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition-transform duration-300"></div>
                        </div>
                        <div class="ml-3 text-slate-300 font-medium">${label}</div>
                    </label>
                `;
            }

            // Function to generate settings section HTML
            function getSectionHTML(sectionId) {
                switch (sectionId) {
                    case 'profile-personalization':
                        return `
                             <div class="space-y-6">
                                <!-- Edit Profile Card -->
                                <div class="p-6 bg-slate-800/50 rounded-xl border border-slate-700/80">
                                    <h3 class="text-xl font-semibold mb-4">Edit Profile</h3>
                                    <form id="profile-form" class="space-y-4">
                                        <div class="flex items-center gap-4">
                                            <img id="profile-img-preview" src="https://placehold.co/80x80/1E293B/94A3B8?text=User" alt="Profile Picture" class="w-20 h-20 rounded-full object-cover">
                                            <div>
                                                <label for="profile-picture-upload" class="cursor-pointer bg-sky-500 text-white px-4 py-2 rounded-md text-sm font-semibold hover:bg-sky-600 transition">Upload Photo</label>
                                                <input type="file" id="profile-picture-upload" class="hidden" accept="image/*">
                                                <p class="text-xs text-slate-500 mt-2">PNG, JPG, GIF up to 5MB.</p>
                                            </div>
                                        </div>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="font-medium text-sm text-slate-400">Full Name</label>
                                                <input type="text" id="profile-name" value="${userProfile.name}" placeholder="e.g., Alex Ryder" class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                            </div>
                                            <div>
                                                <label class="font-medium text-sm text-slate-400">Email Address</label>
                                                <input type="email" id="profile-email" value="${userProfile.email}" placeholder="e.g., alex.ryder@example.com" class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                            </div>
                                        </div>
                                        <div>
                                            <label class="font-medium text-sm text-slate-400">Phone Number</label>
                                            <input type="tel" id="profile-phone" value="${userProfile.phone}" maxlength="13" placeholder="+919876543210" class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                        </div>
                                        <div class="text-right">
                                            <button type="submit" class="bg-sky-500 text-white px-5 py-2 rounded-md font-semibold hover:bg-sky-600 transition">Save Changes</button>
                                        </div>
                                    </form>
                                </div>
                                
                                <!-- Language & Region Card -->
                                <div class="p-6 bg-slate-800/50 rounded-xl border border-slate-700/80">
                                    <h3 class="text-xl font-semibold mb-4">Language & Region</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label for="language" class="font-medium text-sm text-slate-400">Language</label>
                                            <select id="language" class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                                <option>English (US)</option>
                                                <option>English (UK)</option>
                                                <option>Hindi (हिन्दी)</option>
                                                <option>Spanish (Español)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="currency" class="font-medium text-sm text-slate-400">Currency</label>
                                            <select id="currency" class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                                <option>INR (₹)</option>
                                                <option>USD ($)</option>
                                                <option>EUR (€)</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label for="date-format" class="font-medium text-sm text-slate-400">Date Format</label>
                                            <select id="date-format" class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                                <option>DD/MM/YYYY</option>
                                                <option>MM/DD/YYYY</option>
                                                <option>YYYY-MM-DD</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    case 'privacy-security':
                        return `
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Change Password -->
                                <div class="p-6 bg-slate-800/50 rounded-xl border border-slate-700/80">
                                    <h3 class="text-xl font-semibold mb-4">Change Password</h3>
                                    <form id="password-form" class="space-y-4">
                                        <div>
                                            <label class="font-medium text-sm text-slate-400">Current Password</label>
                                            <input type="password" id="current-password" placeholder="Enter your current password" class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                        </div>
                                        <div>
                                            <label class="font-medium text-sm text-slate-400">New Password</label>
                                            <input type="password" id="new-password" placeholder="Enter your new password" class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                            <p class="text-xs text-slate-500 mt-1">Must be letters, followed by a symbol, then numbers (e.g., Secret@123).</p>
                                        </div>
                                        <div>
                                            <label class="font-medium text-sm text-slate-400">Confirm New Password</label>
                                            <input type="password" id="confirm-password" placeholder="Confirm your new password" class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                        </div>
                                        <div class="text-right">
                                            <button type="submit" class="bg-sky-500 text-white px-5 py-2 rounded-md font-semibold hover:bg-sky-600 transition">Update Password</button>
                                        </div>
                                    </form>
                                </div>
                                <!-- Security Settings -->
                                <div class="p-6 bg-slate-800/50 rounded-xl border border-slate-700/80 space-y-5">
                                    <h3 class="text-xl font-semibold">Security Settings</h3>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-slate-300">Two-Factor Authentication (2FA)</p>
                                            <p class="text-sm text-slate-400">Add an extra layer of security to your account.</p>
                                        </div>
                                        ${createToggle('2fa-toggle', '', true)}
                                    </div>
                                    <div class="border-t border-slate-700"></div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-slate-300">App Lock</p>
                                            <p class="text-sm text-slate-400">Require PIN or biometrics to open the app.</p>
                                        </div>
                                        ${createToggle('app-lock-toggle', '')}
                                    </div>
                                    <div class="border-t border-slate-700"></div>
                                    <div>
                                        <label class="font-medium text-sm text-slate-400">Session Timeout</label>
                                        <select class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                            <option>15 minutes</option>
                                            <option>30 minutes</option>
                                            <option>1 hour</option>
                                            <option>Never</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        `;
                    case 'notifications-alerts':
                        return `
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Notification Preferences -->
                                <div class="p-6 bg-slate-800/50 rounded-xl border border-slate-700/80">
                                    <h3 class="text-xl font-semibold mb-4">Notification Preferences</h3>
                                    <p class="text-slate-400 mb-6">Choose how you want to be notified.</p>
                                    <div class="space-y-5">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="font-medium text-slate-300">Email Notifications</p>
                                                <p class="text-sm text-slate-400">Receive summaries and alerts in your inbox.</p>
                                            </div>
                                            ${createToggle('email-notifications-toggle', '', true)}
                                        </div>
                                        <div class="border-t border-slate-700"></div>
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="font-medium text-slate-300">Push Notifications</p>
                                                <p class="text-sm text-slate-400">Get real-time alerts on your device.</p>
                                            </div>
                                            ${createToggle('push-notifications-toggle', '', true)}
                                        </div>
                                        <div class="border-t border-slate-700"></div>
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="font-medium text-slate-300">SMS Alerts</p>
                                                <p class="text-sm text-slate-400">For critical alerts only.</p>
                                            </div>
                                            ${createToggle('sms-notifications-toggle', '')}
                                        </div>
                                    </div>
                                </div>

                                <!-- Custom Alerts & Data Sharing -->
                                <div class="p-6 bg-slate-800/50 rounded-xl border border-slate-700/80 space-y-6">
                                    <div>
                                        <h3 class="text-xl font-semibold mb-4">Custom Alerts</h3>
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="font-medium text-slate-300">Expense Threshold</p>
                                                <p class="text-sm text-slate-400">Notify when an expense exceeds a set amount.</p>
                                            </div>
                                            ${createToggle('expense-threshold-toggle', '', true)}
                                        </div>
                                        <div class="mt-4">
                                            <label for="expense-threshold-amount" class="font-medium text-sm text-slate-400">Threshold Amount (₹)</label>
                                            <input type="number" id="expense-threshold-amount" value="5000" class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                        </div>
                                    </div>

                                    <div class="border-t border-slate-700"></div>

                                    <div>
                                        <h3 class="text-xl font-semibold mb-4">Share Data Report (CSV)</h3>
                                        <p class="text-slate-400 mb-4">Export and send your data report.</p>
                                        <div class="flex flex-wrap gap-3">
                                            <button id="send-email-btn" class="flex items-center gap-2 bg-slate-700 hover:bg-slate-600/80 text-white px-4 py-2 rounded-md font-semibold transition"><i data-lucide="mail" class="w-5 h-5"></i> Send to Email</button>
                                            <button id="send-sms-btn" class="flex items-center gap-2 bg-slate-700 hover:bg-slate-600/80 text-white px-4 py-2 rounded-md font-semibold transition"><i data-lucide="smartphone" class="w-5 h-5"></i> Send via SMS</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                    case 'backup-data':
                        return `
                            <div class="p-6 bg-slate-800/50 rounded-xl border border-slate-700/80">
                                <h3 class="text-xl font-semibold mb-6">Backup & Data Control</h3>
                                <div class="space-y-6">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-slate-300">Cloud Sync (Google Drive)</p>
                                            <p class="text-sm text-slate-400">Automatically back up your data to the cloud.</p>
                                        </div>
                                        ${createToggle('cloud-sync-toggle', '', true)}
                                    </div>
                                    <div class="border-t border-slate-700"></div>
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="font-medium text-slate-300">Offline Mode</p>
                                            <p class="text-sm text-slate-400">Enable access to your data without an internet connection.</p>
                                        </div>
                                        ${createToggle('offline-mode-toggle', '')}
                                    </div>
                                    <div class="border-t border-slate-700"></div>
                                    <div>
                                        <h4 class="font-semibold text-red-400">Danger Zone</h4>
                                        <p class="text-sm text-slate-400 mt-1 mb-4">These actions are permanent and cannot be undone.</p>
                                        <button id="delete-data-btn" class="bg-red-600/20 text-red-400 border border-red-500/50 px-4 py-2 rounded-md font-semibold hover:bg-red-600/30 hover:text-red-300 transition">Delete All Data</button>
                                    </div>
                                </div>
                            </div>
                        `;
                    case 'help-support':
                         return `
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- Feedback Form -->
                                <div class="p-6 bg-slate-800/50 rounded-xl border border-slate-700/80">
                                    <h3 class="text-xl font-semibold mb-4">Feedback & Bug Report</h3>
                                    <form class="space-y-4">
                                        <div>
                                            <label for="feedback-subject" class="font-medium text-sm text-slate-400">Subject</label>
                                            <input type="text" id="feedback-subject" placeholder="e.g., Feature Request, Bug Report" class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500">
                                        </div>
                                        <div>
                                            <label for="feedback-message" class="font-medium text-sm text-slate-400">Message</label>
                                            <textarea id="feedback-message" rows="4" placeholder="Describe your feedback or the issue you're facing in detail..." class="mt-1 w-full bg-slate-700/50 border border-slate-600 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-sky-500"></textarea>
                                        </div>
                                        <div class="text-right">
                                            <button type="submit" class="bg-sky-500 text-white px-5 py-2 rounded-md font-semibold hover:bg-sky-600 transition">Submit Feedback</button>
                                        </div>
                                    </form>
                                </div>
                                <!-- FAQs & Contact -->
                                <div class="p-6 bg-slate-800/50 rounded-xl border border-slate-700/80 space-y-6">
                                    <div>
                                        <h3 class="text-xl font-semibold mb-4">FAQs & Tutorials</h3>
                                        <div class="space-y-2">
                                            <a href="#" class="block text-sky-400 hover:text-sky-300 transition">How to change my password?</a>
                                            <a href="#" class="block text-sky-400 hover:text-sky-300 transition">How to enable Two-Factor Authentication?</a>
                                            <a href="#" class="block text-sky-400 hover:text-sky-300 transition">Is my data secure?</a>
                                        </div>
                                    </div>
                                    <div class="border-t border-slate-700"></div>
                                    <div>
                                        <h3 class="text-xl font-semibold mb-4">Contact Support</h3>
                                        <div class="flex flex-wrap gap-3">
                                            <button class="flex items-center gap-2 bg-slate-700 hover:bg-slate-600/80 text-white px-4 py-2 rounded-md font-semibold transition"><i data-lucide="mail" class="w-5 h-5"></i> Email Support</button>
                                            <button class="flex items-center gap-2 bg-slate-700 hover:bg-slate-600/80 text-white px-4 py-2 rounded-md font-semibold transition"><i data-lucide="message-circle" class="w-5 h-5"></i> Start Chatbot</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                         `;
                    // Default case for sections without specific UI yet
                    default:
                        return `<div class="p-6 bg-slate-800/50 rounded-xl border border-slate-700/80"><p class="text-slate-400">Settings for ${sectionId.replace(/-/g, ' ')} will be available soon.</p></div>`;
                }
            }
            
            // Initialize settings sections
            function initSettings() {
                // Populate main content
                settingsContainer.innerHTML = settingsConfig.map(section => `
                    <section id="${section.id}" class="setting-section">
                        <button class="accordion-header w-full flex justify-between items-center p-4 bg-slate-800/80 rounded-t-xl border border-slate-700 hover:bg-slate-700/80 transition-colors" data-section="${section.id}">
                            <div class="flex items-center gap-3">
                                <i data-lucide="${section.icon}" class="w-5 h-5 text-sky-400"></i>
                                <h2 class="text-lg font-semibold">${section.title}</h2>
                            </div>
                            <i data-lucide="chevron-down" class="w-5 h-5 transition-transform duration-300"></i>
                        </button>
                        <div class="accordion-content border border-t-0 border-slate-700 rounded-b-xl">
                            <div class="p-4 sm:p-6">
                                ${getSectionHTML(section.id)}
                            </div>
                        </div>
                    </section>
                `).join('');

                lucide.createIcons();
                addEventListeners();
                
                // Open the first section by default
                const firstSection = document.querySelector('.setting-section');
                if (firstSection) {
                    firstSection.querySelector('.accordion-header').classList.add('active');
                    firstSection.querySelector('.accordion-content').classList.add('open');
                    const chevronIcon = firstSection.querySelector('.accordion-header .lucide-chevron-down');
                    if (chevronIcon) {
                       chevronIcon.style.transform = 'rotate(180deg)';
                    }
                }
            }


            // --- EVENT HANDLING ---
            function addEventListeners() {
                // Accordion navigation
                document.querySelectorAll('.accordion-header').forEach(el => {
                    el.addEventListener('click', (e) => {
                        e.preventDefault();
                        const sectionId = el.dataset.section;
                        toggleSection(sectionId);
                    });
                });

                // Search functionality
                searchInput.addEventListener('input', handleSearch);

                // Modal controls
                const deleteBtn = document.getElementById('delete-data-btn');
                if(deleteBtn) {
                     deleteBtn.addEventListener('click', () => {
                        showModal(
                            'Delete All Data', 
                            'This will permanently delete all your tasks, financial records, and settings. This action is irreversible.',
                            handleDataDeletion
                        );
                    });
                }
                document.getElementById('modal-cancel').addEventListener('click', hideModal);
                
                // Tooltip
                document.querySelectorAll('[data-tooltip]').forEach(el => {
                    el.addEventListener('mouseenter', showTooltip);
                    el.addEventListener('mouseleave', hideTooltip);
                });
                
                // --- FORMS ---
                const profileForm = document.getElementById('profile-form');
                if(profileForm) {
                    profileForm.addEventListener('submit', handleProfileSave);
                }

                const passwordForm = document.getElementById('password-form');
                if(passwordForm) {
                    passwordForm.addEventListener('submit', handlePasswordUpdate);
                }

                // Profile picture upload
                const picUpload = document.getElementById('profile-picture-upload');
                if (picUpload) {
                    picUpload.addEventListener('change', handlePictureUpload);
                }
                
                // Phone number validation
                const phoneInput = document.getElementById('profile-phone');
                if (phoneInput) {
                    phoneInput.addEventListener('input', (e) => {
                        e.target.value = e.target.value.replace(/[^0-9+]/g, '');
                    });
                }

                // Data sharing buttons
                const sendEmailBtn = document.getElementById('send-email-btn');
                if (sendEmailBtn) {
                    sendEmailBtn.addEventListener('click', sendDataByEmail);
                }
                const sendSmsBtn = document.getElementById('send-sms-btn');
                if (sendSmsBtn) {
                    sendSmsBtn.addEventListener('click', sendDataBySms);
                }
            }

            // --- HANDLER FUNCTIONS ---
            
            function handleDataDeletion() {
                // Reset user profile data object
                userProfile.name = '';
                userProfile.email = '';
                userProfile.phone = '';

                // In a real app, you would also clear localStorage, IndexedDB, and make an API call to the server.
                console.log('All local data has been cleared.');

                // Update the UI to reflect the changes
                document.getElementById('profile-name').value = '';
                document.getElementById('profile-email').value = '';
                document.getElementById('profile-phone').value = '';
                document.getElementById('profile-img-preview').src = 'https://placehold.co/80x80/1E293B/94A3B8?text=User';

                // Reset password form for security
                 const passwordForm = document.getElementById('password-form');
                 if(passwordForm) passwordForm.reset();
                
                showToast('All app data has been deleted.', 'success');
            }

            function handlePictureUpload(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const preview = document.getElementById('profile-img-preview');
                        preview.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            }

            function handleProfileSave(event) {
                event.preventDefault();
                userProfile.name = document.getElementById('profile-name').value;
                userProfile.email = document.getElementById('profile-email').value;
                userProfile.phone = document.getElementById('profile-phone').value;
                console.log('Profile saved:', userProfile);
                showToast('Profile changes saved successfully!', 'success');
            }

            function handlePasswordUpdate(event) {
                event.preventDefault();
                const currentPassword = document.getElementById('current-password').value;
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;

                if (newPassword === currentPassword) {
                    showToast('New password cannot be the same as the current password.', 'error');
                    return;
                }
                
                if (newPassword !== confirmPassword) {
                    showToast('New passwords do not match.', 'error');
                    return;
                }

                const validation = validatePassword(newPassword);
                if (!validation.isValid) {
                    showToast(validation.message, 'error');
                    return;
                }
                
                // Logic to update password would go here
                console.log('Password updated successfully.');
                showToast('Password has been updated!', 'success');
                event.target.reset(); // Clear form fields
            }

            // --- HELPERS ---

             function validatePassword(password) {
                if (password.length < 8) {
                    return { isValid: false, message: "Password must be at least 8 characters long." };
                }
                
                // Regex to enforce the pattern: letters, then symbols, then digits.
                const pattern = /^[a-zA-Z]+[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+[0-9]+$/;
                
                if (!pattern.test(password)) {
                    return { 
                        isValid: false, 
                        message: "Password must follow the pattern: letters, then a symbol, then numbers (e.g., Secret@123)." 
                    };
                }

                return { isValid: true };
            }

            function generateDummyCSV() {
                // In a real app, you'd generate this from actual user data.
                const headers = "Date,Type,Category,Amount,Description";
                const rows = [
                    "2025-08-30,Expense,Food,550.00,Lunch with team",
                    "2025-08-29,Income,Salary,75000.00,Monthly Salary",
                    "2025-08-28,Expense,Travel,1200.00,Cab to airport"
                ];
                return [headers, ...rows].join("\n");
            }

            function sendDataByEmail() {
                const csvData = generateDummyCSV();
                const subject = "Your DailyOS Data Report";
                const body = `Hi ${userProfile.name},\n\nPlease find your data report in CSV format below.\n\n---\n${csvData}\n---\n\nBest,\nThe DailyOS Team`;
                
                // Use mailto: to open the default email client
                const mailtoLink = `mailto:${userProfile.email}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                window.location.href = mailtoLink;
                
                showToast("Opening your email client...");
            }

            function sendDataBySms() {
                const csvData = generateDummyCSV();
                const body = `Your DailyOS Data Report:\n${csvData}`;

                // Note: SMS has character limits and this is a simplified client-side approach.
                const smsLink = `sms:${userProfile.phone}?&body=${encodeURIComponent(body)}`;
                window.location.href = smsLink;

                showToast("Opening your messaging app...");
            }

            function showToast(message, type = 'info') {
                const toast = document.getElementById('toast-notification');
                const toastMessage = document.getElementById('toast-message');
                if (!toast || !toastMessage) return;

                // Reset classes
                toast.className = 'fixed bottom-5 right-5 text-white px-6 py-3 rounded-lg shadow-lg transform transition-all duration-500 z-50';

                // Apply new classes
                if (type === 'success') {
                    toast.classList.add('bg-emerald-500');
                } else if (type === 'error') {
                    toast.classList.add('bg-red-500');
                } else {
                    toast.classList.add('bg-sky-500');
                }
                
                toastMessage.textContent = message;
                toast.classList.remove('translate-y-20', 'opacity-0');

                setTimeout(() => {
                    toast.classList.add('translate-y-20', 'opacity-0');
                }, 4000); // Hide after 4 seconds
            }

            function toggleSection(sectionId) {
                const section = document.getElementById(sectionId);
                if (!section) return;

                const header = section.querySelector('.accordion-header');
                const content = section.querySelector('.accordion-content');
                const chevron = header.querySelector('.lucide-chevron-down');

                // Close all other sections
                document.querySelectorAll('.accordion-content.open').forEach(openContent => {
                    if (openContent !== content) {
                        openContent.classList.remove('open');
                        const openHeader = openContent.previousElementSibling;
                        openHeader.classList.remove('active');
                        const openChevron = openHeader.querySelector('.lucide-chevron-down');
                        if (openChevron) {
                           openChevron.style.transform = 'rotate(0deg)';
                        }
                    }
                });

                // Toggle current section
                const isOpen = content.classList.toggle('open');
                header.classList.toggle('active', isOpen);
                if (chevron) {
                    chevron.style.transform = isOpen ? 'rotate(180deg)' : 'rotate(0deg)';
                }

                // Scroll to section if opened
                if (isOpen) {
                    section.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
            
            function switchTheme(theme) {
                const lightModeBtn = document.getElementById('light-mode-btn');
                const darkModeBtn = document.getElementById('dark-mode-btn');
                
                if (theme === 'light') {
                    document.documentElement.classList.remove('dark');
                    lightModeBtn.classList.add('bg-white', 'text-slate-800');
                    darkModeBtn.classList.remove('bg-slate-600', 'text-white');
                } else {
                    document.documentElement.classList.add('dark');
                    darkModeBtn.classList.add('bg-slate-600', 'text-white');
                    lightModeBtn.classList.remove('bg-white', 'text-slate-800');
                }
            }

            function handleSearch(e) {
                const searchTerm = e.target.value.toLowerCase();
                document.querySelectorAll('.setting-section').forEach(section => {
                    const sectionText = section.textContent.toLowerCase();
                    const isVisible = sectionText.includes(searchTerm);
                    section.style.display = isVisible ? 'block' : 'none';
                });
            }
            
            function showModal(title, description, onConfirm) {
                document.getElementById('modal-title').textContent = title;
                document.getElementById('modal-description').textContent = description;
                
                const confirmBtn = document.getElementById('modal-confirm');
                // Clone and replace the button to remove old event listeners
                const newConfirmBtn = confirmBtn.cloneNode(true);
                confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
                newConfirmBtn.addEventListener('click', () => {
                    onConfirm();
                    hideModal();
                });

                confirmationModal.classList.remove('hidden');
                setTimeout(() => {
                    confirmationModal.classList.remove('opacity-0');
                    confirmationModal.querySelector('div').classList.remove('scale-95');
                }, 10);
            }

            function hideModal() {
                confirmationModal.classList.add('opacity-0');
                confirmationModal.querySelector('div').classList.add('scale-95');
                setTimeout(() => {
                    confirmationModal.classList.add('hidden');
                }, 300);
            }

            function showTooltip(e) {
                const text = e.target.dataset.tooltip;
                if (!text) return;
                
                tooltipElement.textContent = text;
                tooltipElement.classList.remove('opacity-0');

                const rect = e.target.getBoundingClientRect();
                tooltipElement.style.left = `${rect.left + rect.width / 2 - tooltipElement.offsetWidth / 2}px`;
                tooltipElement.style.top = `${rect.top - tooltipElement.offsetHeight - 8}px`;
            }

            function hideTooltip() {
                tooltipElement.classList.add('opacity-0');
            }


            // --- INITIALIZATION ---
            initSettings();
        });
    </script>
</body>

</html>

